# 階段三生物特徵認證機制

**建立日期**：2026-01-22  
**權限歸屬**：第一類可究責對象（系統創辦人，本系統設計人）

---

## 🔐 階段三認證要求

### 核心要求

**階段三權限認證採生物特徵辨認。**

階段三權限解放是系統的「最後防線」，允許系統創辦人無視任何安全規定執行極度危險的操作（如格式化地端機、斷網隔離）。因此，必須使用**最高安全等級的認證機制**：**生物特徵辨認**。

---

## 🎯 生物特徵辨認機制

### 認證流程

1. **身份確認**：
   - 檢查是否為系統創辦人，本系統設計人（第一類可究責對象）
   - 檢查 `design_responsibility.natural_person.name == "系統創辦人，本系統設計人"`
   - 檢查 `design_responsibility.natural_person.priority == 1`

2. **生物特徵掃描**：
   - 使用筆電鏡頭進行生物特徵掃描
   - 對照內部身份證檔案（`internal_id_records.json`）
   - 驗證生物特徵與身份證記錄是否匹配

3. **MAC地址驗證**：
   - 驗證操作設備的MAC地址
   - 確保操作來自授權的設備

4. **權限授予**：
   - 通過所有驗證後，授予階段三權限
   - 允許無視任何安全規定執行操作

### 生物特徵驗證實作

#### 1. 使用筆電鏡頭

```javascript
// 啟動生物特徵掃描
async function startBiometricScan() {
    const stream = await navigator.mediaDevices.getUserMedia({ 
        video: { facingMode: 'user' } 
    });
    // 進行人臉識別和比對
}
```

#### 2. 對照內部身份證檔案

```python
def verify_biometric_against_id(
    name: str,
    id_number: str = None,
    biometric_data: Dict[str, Any] = None
) -> Dict[str, Any]:
    """
    對照生物特徵與內部身份證檔案
    - 讀取 internal_id_records.json
    - 比對姓名和身份證號碼
    - 驗證生物特徵（人臉識別）
    """
    # 載入內部身份證記錄
    id_record = find_id_record_by_name(name)
    
    # 驗證身份證號碼
    if id_number and id_record.get("id_number") != id_number:
        return {"verified": False, "error": "身份證號碼不匹配"}
    
    # 生物特徵驗證（人臉識別）
    if biometric_data:
        # 比對生物特徵與身份證記錄
        biometric_verified = verify_facial_recognition(
            biometric_data, 
            id_record
        )
    else:
        biometric_verified = False
    
    return {
        "verified": True,
        "biometric_verified": biometric_verified,
        "id_record": id_record
    }
```

#### 3. 階段三權限檢查

```python
def check_stage3_permission(account_id: str, biometric_verified: bool) -> bool:
    """
    檢查階段三權限
    - 必須是系統創辦人（第一類可究責對象）
    - 必須通過生物特徵辨認
    """
    # 檢查是否為系統創辦人
    if not is_founder(account_id):
        return False
    
    # 必須通過生物特徵辨認
    if not biometric_verified:
        return False
    
    return True
```

---

## 🔒 安全考量

### 為什麼需要生物特徵辨認？

階段三權限解放允許執行**極度危險**的操作：
- **格式化地端機**：完全清除所有資料
- **斷網隔離**：切斷所有網路連線
- **無視所有安全規定**：繞過所有權限檢查

這些操作如果被未授權人員使用，可能造成：
- **系統完全損壞**
- **資料完全遺失**
- **服務完全中斷**
- **無法恢復的損害**

因此，必須使用**最高安全等級的認證機制**：**生物特徵辨認**，確保只有系統創辦人本人可以使用階段三權限。

### 生物特徵辨認的優勢

1. **唯一性**：每個人的生物特徵都是獨特的
2. **難以偽造**：生物特徵難以被偽造或複製
3. **即時驗證**：可以即時驗證身份
4. **可追溯性**：所有生物特徵驗證都有記錄

### 多重驗證機制

階段三權限認證採用**多重驗證機制**：

1. **身份確認**：檢查是否為系統創辦人
2. **生物特徵辨認**：使用筆電鏡頭進行人臉識別
3. **MAC地址驗證**：驗證操作設備
4. **內部身份證記錄對照**：對照 `internal_id_records.json`

---

## 📋 實作要求

### 1. 生物特徵掃描介面

- **使用筆電鏡頭**：透過 `getUserMedia` API 取得鏡頭權限
- **即時人臉識別**：使用人臉識別技術進行即時比對
- **對照內部記錄**：與 `internal_id_records.json` 中的記錄比對

### 2. 驗證流程整合

- **整合到 `little_j_policy.py`**：在 `account_permission_stage()` 中檢查生物特徵驗證狀態
- **整合到 `decide_execution()`**：在階段三權限檢查時要求生物特徵驗證
- **整合到 UI**：在 `wuchang_control_center.html` 中提供生物特徵掃描介面

### 3. 記錄與稽核

- **記錄所有生物特徵驗證**：記錄驗證時間、結果、操作
- **記錄所有階段三操作**：記錄所有使用階段三權限的操作
- **可追溯性**：所有記錄都必須可追溯到系統創辦人

---

## 📝 相關檔案

1. **個人AI綁定**：`personal_ai_binding.py`
   - `verify_biometric_against_id()`：生物特徵驗證函數

2. **內部身份證記錄**：`internal_id_records.json`
   - 儲存系統創辦人的身份證記錄

3. **政策控制**：`little_j_policy.py`
   - `account_permission_stage()`：權限階段判定
   - `decide_execution()`：執行權限檢查

4. **UI介面**：`wuchang_control_center.html`
   - 生物特徵掃描介面

---

## ✅ 實作狀態

- [x] 生物特徵辨認機制已設計
- [x] 驗證流程已定義
- [x] 安全考量已說明
- [x] 階段三權限檢查整合生物特徵驗證（`little_j_policy.py`）
- [x] `account_permission_stage()` 已更新，要求生物特徵驗證
- [x] `decide_execution()` 已更新，檢查生物特徵驗證狀態
- [ ] 生物特徵辨認實作（需要整合人臉識別技術）

---

**建立時間**：2026-01-22  
**最後更新**：2026-01-22  
**權限歸屬**：系統創辦人，本系統設計人（第一類可究責對象）
