# 雙身份資訊更新

**更新時間**：2026-01-22  
**資料來源**：路由器管理介面截圖

---

## 📋 確認的雙身份資訊

### 身份 1（有線網卡 - server）

| 項目 | 值 |
|------|-----|
| **名稱** | server |
| **IPv4** | `192.168.50.249` |
| **IPv6** | `fe80::9449:739a:4999:f566` |
| **MAC** | `30:9C:23:4A:9B:1B` |
| **類型** | 有線網卡 |
| **介面** | 有線連接 |
| **IP 分配** | Manual（手動設定） |

### 身份 2（WiFi 網卡 - svrver 2）

| 項目 | 值 |
|------|-----|
| **名稱** | svrver 2（路由器顯示，可能是 server 2 的拼寫變體） |
| **IPv4** | **待確認**（目前只顯示 IPv6） |
| **IPv6** | `fe80::cdf9:2266:dc55:bcc6` |
| **MAC** | `1C:3E:84:67:C0:16` |
| **類型** | WiFi 網卡 |
| **介面** | work_IoT (5G Wi-Fi) |
| **IP 分配** | Static（靜態） |
| **流量** | Tx: 300, Rx: 300 |

---

## 🔍 重要發現

### 1. 身份 2 的 IPv4 地址

**問題**：路由器介面只顯示了身份 2 的 IPv6 地址，沒有顯示 IPv4 地址。

**可能原因**：
- IPv4 地址可能在其他頁面顯示
- 可能需要查看 DHCP 租約列表
- 可能使用靜態 IP 但未在當前頁面顯示

**解決方法**：
1. 在路由器管理介面查看「DHCP 租約」或「網路地圖」
2. 在伺服器上執行 `ip addr show` 或 `ifconfig` 查看 WiFi 網卡的 IPv4
3. 使用 `list_router_devices.py` 腳本查詢

### 2. 設備名稱差異

- 路由器顯示：`svrver 2`（可能是拼寫錯誤或顯示問題）
- 實際名稱：可能是 `server 2`

**處理方式**：
- Odoo 模組已更新，可識別 `server 2`、`server2`、`svrver 2`、`svrver2` 等變體

---

## 🚀 下一步行動

### 1. 確認身份 2 的 IPv4 地址

**方法 A：在路由器查看**
- 前往「網路地圖」→「用戶端」
- 尋找 MAC 地址 `1C:3E:84:67:C0:16` 的設備
- 查看其 IPv4 地址

**方法 B：在伺服器查看**
```bash
# 查看所有網卡和 IP
ip addr show

# 或
ifconfig

# 尋找 WiFi 網卡（work_IoT）的 IPv4
```

**方法 C：使用查詢腳本**
```bash
python list_router_devices.py
```

### 2. 更新 Cloudflare Tunnel 配置

確認身份 2 的 IPv4 後，可以：

**選項 A：所有服務使用身份 1（當前配置）**
```yaml
ingress:
  - hostname: wuchang.life
    service: http://192.168.50.249:80  # 身份 1
```

**選項 B：服務分散到兩個身份**
```yaml
ingress:
  # 身份 1 的服務（有線）
  - hostname: wuchang.life
    service: http://192.168.50.249:80
  
  # 身份 2 的服務（WiFi）
  - hostname: app.wuchang.org.tw
    service: http://192.168.50.XXX:8069  # 身份 2 IPv4（待確認）
```

### 3. 更新 Odoo 記錄

1. 在 Odoo 中同步設備列表
2. 確認 "server" 和 "svrver 2" 都被正確識別
3. 更新伺服器身份記錄中的 IPv4 地址

---

## 📝 雙網卡特殊運用場景

### 1. 負載均衡
- 將不同服務分散到兩個網卡
- 例如：身份 1 處理主要服務，身份 2 處理備援或測試服務

### 2. 容錯備援
- 身份 1 為主，身份 2 為備
- 當有線網卡故障時，自動切換到 WiFi

### 3. 服務隔離
- 身份 1（有線）：對外服務（wuchang.life, app.wuchang.org.tw）
- 身份 2（WiFi）：內部管理服務或測試環境

### 4. 流量分流
- 根據服務類型或優先級分配流量
- 例如：高優先級服務使用有線，低優先級使用 WiFi

### 5. 網路隔離
- 有線網卡連接主要網路
- WiFi 網卡連接 IoT 網路（work_IoT），實現網路隔離

---

## ✅ 已更新項目

- [x] Odoo 模組設備識別邏輯（支援 server 和 svrver 2）
- [x] 伺服器身份模型預設值（server 和 server 2）
- [x] 雙身份配置確認文件
- [ ] 確認身份 2 的 IPv4 地址（待完成）
- [ ] 更新 Cloudflare Tunnel 配置（待完成）

---

**建立時間**：2026-01-22
