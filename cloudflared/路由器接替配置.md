# Cloudflare Tunnel è·¯ç”±å™¨æ¥æ›¿é…ç½®

**é‡è¦**ï¼šä¼ºæœå™¨ä½åœ¨è·¯ç”±å™¨å…§éƒ¨ç¶²è·¯ï¼Œæ‰€æœ‰è¨­å®šå¿…é ˆç‚ºè·¯ç”±å™¨å¯æ¥æ›¿ã€‚

---

## ğŸ“‹ ç¶²è·¯æ¶æ§‹

### è·¯ç”±å™¨è³‡è¨Š
- **å¤–éƒ¨ IP**ï¼š`220.135.21.74`
- **å…§éƒ¨ IP**ï¼š`192.168.50.84`
- **DDNS**ï¼š`coffeeLofe.asuscomm.com`
- **å‹è™Ÿ**ï¼šASUS RT-BE86U

### ä¼ºæœå™¨ä½ç½®
- **ä½ç½®**ï¼šè·¯ç”±å™¨å…§éƒ¨ç¶²è·¯ï¼ˆLANï¼‰
- **å…§éƒ¨ IP**ï¼šéœ€è¦ç¢ºèªï¼ˆå¯èƒ½æ˜¯ `192.168.50.x`ï¼‰
- **å®¹å™¨ç¶²è·¯**ï¼šDocker å…§éƒ¨ç¶²è·¯

---

## ğŸ”§ é…ç½®èª¿æ•´

### 1. æœå‹™åœ°å€é…ç½®

**Cloudflare Tunnel éœ€è¦è¨ªå•çš„æœå‹™**ï¼š

#### é¸é … Aï¼šä½¿ç”¨å®¹å™¨åç¨±ï¼ˆæ¨è–¦ï¼‰

å¦‚æœä¼ºæœå™¨å’Œ Cloudflare Tunnel å®¹å™¨åœ¨åŒä¸€ Docker ç¶²è·¯ä¸­ï¼š

```yaml
ingress:
  - hostname: wuchang.life
    service: http://wuchang-caddy-1:80  # å®¹å™¨åç¨±
```

#### é¸é … Bï¼šä½¿ç”¨å…§éƒ¨ IP

å¦‚æœä½¿ç”¨å…§éƒ¨ IPï¼š

```yaml
ingress:
  - hostname: wuchang.life
    service: http://192.168.50.XXX:80  # ä¼ºæœå™¨å…§éƒ¨ IP
```

#### é¸é … Cï¼šä½¿ç”¨è·¯ç”±å™¨ç«¯å£è½‰ç™¼

å¦‚æœéœ€è¦é€šéè·¯ç”±å™¨ç«¯å£è½‰ç™¼ï¼š

```yaml
ingress:
  - hostname: wuchang.life
    service: http://192.168.50.84:XXXX  # è·¯ç”±å™¨å…§éƒ¨ IP + è½‰ç™¼ç«¯å£
```

---

## ğŸš€ è·¯ç”±å™¨é…ç½®éœ€æ±‚

### 1. ç«¯å£è½‰ç™¼ï¼ˆå¦‚éœ€è¦ï¼‰

**å¦‚æœ Cloudflare Tunnel å®¹å™¨ç„¡æ³•ç›´æ¥è¨ªå•æœå‹™å®¹å™¨**ï¼Œéœ€è¦é…ç½®è·¯ç”±å™¨ç«¯å£è½‰ç™¼ï¼š

```python
from router_full_control import RouterFullControl

router = RouterFullControl()
router.login()

# æ·»åŠ ç«¯å£è½‰ç™¼è¦å‰‡
router.add_port_forwarding_rule(
    external_port=8080,  # å¤–éƒ¨ç«¯å£
    internal_ip="192.168.50.XXX",  # ä¼ºæœå™¨å…§éƒ¨ IP
    internal_port=80,  # æœå‹™ç«¯å£
    protocol="TCP",
    description="Cloudflare Tunnel - Caddy"
)
```

### 2. DDNS é…ç½®

**ç¢ºä¿ DDNS æ­£å¸¸é‹ä½œ**ï¼š

```python
ddns_status = router.get_ddns_status()
# ç¢ºèª DDNS å·²å•Ÿç”¨ä¸¦æ­£å¸¸æ›´æ–°
```

### 3. é˜²ç«ç‰†è¦å‰‡

**ç¢ºä¿å…è¨± Cloudflare Tunnel æµé‡**ï¼š

```python
# æª¢æŸ¥é˜²ç«ç‰†è¦å‰‡
firewall_rules = router.get_firewall_rules()
# ç¢ºä¿å…è¨±å¿…è¦çš„ç«¯å£å’Œå”è­°
```

---

## ğŸ“ é…ç½®æª”æ¡ˆèª¿æ•´

### æª¢æŸ¥ä¼ºæœå™¨å…§éƒ¨ IP

**åœ¨ä¼ºæœå™¨ä¸ŠåŸ·è¡Œ**ï¼š

```bash
# æª¢æŸ¥ä¼ºæœå™¨å…§éƒ¨ IP
ip addr show | grep "192.168.50"

# æˆ–
hostname -I | grep "192.168.50"
```

### æ›´æ–° config.yml

**æ ¹æ“šå¯¦éš›ç¶²è·¯æ¶æ§‹èª¿æ•´**ï¼š

```yaml
tunnel: 837487dd-1536-43ec-a1c9-ee366a0aa4b7
credentials-file: /etc/cloudflared/credentials.json

ingress:
  # é¦–é ï¼ˆæ ¹åŸŸåï¼‰
  - hostname: wuchang.life
    # é¸é … 1ï¼šä½¿ç”¨å®¹å™¨åç¨±ï¼ˆå¦‚æœåŒä¸€ Docker ç¶²è·¯ï¼‰
    service: http://wuchang-caddy-1:80
    # é¸é … 2ï¼šä½¿ç”¨å…§éƒ¨ IPï¼ˆå¦‚æœä¸åŒç¶²è·¯ï¼‰
    # service: http://192.168.50.XXX:80
    # é¸é … 3ï¼šä½¿ç”¨è·¯ç”±å™¨ç«¯å£è½‰ç™¼
    # service: http://192.168.50.84:8080
  
  # å…¶ä»–æœå‹™é¡ä¼¼èª¿æ•´...
```

---

## ğŸ” ç¶²è·¯é€£æ¥æ¸¬è©¦

### 1. æ¸¬è©¦å®¹å™¨é–“é€£æ¥

**åœ¨ Cloudflare Tunnel å®¹å™¨ä¸­æ¸¬è©¦**ï¼š

```bash
# é€²å…¥å®¹å™¨
docker exec -it wuchang-cloudflared sh

# æ¸¬è©¦é€£æ¥
ping wuchang-caddy-1
# æˆ–
wget -O- http://wuchang-caddy-1:80
```

### 2. æ¸¬è©¦è·¯ç”±å™¨é€£æ¥

**å¾ä¼ºæœå™¨æ¸¬è©¦è·¯ç”±å™¨**ï¼š

```bash
# æ¸¬è©¦è·¯ç”±å™¨é€£æ¥
ping 192.168.50.84

# æ¸¬è©¦ç«¯å£è½‰ç™¼ï¼ˆå¦‚æœé…ç½®ï¼‰
curl http://192.168.50.84:8080
```

### 3. æ¸¬è©¦å¤–éƒ¨è¨ªå•

**å¾å¤–éƒ¨æ¸¬è©¦**ï¼š

```bash
# æ¸¬è©¦ HTTPS
curl -I https://wuchang.life

# æ¸¬è©¦ DNS è§£æ
nslookup wuchang.life
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### 1. Docker ç¶²è·¯é…ç½®

**ç¢ºä¿ Cloudflare Tunnel å®¹å™¨å’Œæœå‹™å®¹å™¨åœ¨åŒä¸€ç¶²è·¯ä¸­**ï¼š

```bash
# æª¢æŸ¥ç¶²è·¯
docker network ls

# æª¢æŸ¥å®¹å™¨ç¶²è·¯
docker inspect wuchang-cloudflared | grep NetworkMode
docker inspect wuchang-caddy-1 | grep NetworkMode
```

**å¦‚æœä¸åœ¨åŒä¸€ç¶²è·¯**ï¼š
- ä½¿ç”¨ `--network` åƒæ•¸æŒ‡å®šç¶²è·¯
- æˆ–ä½¿ç”¨ `docker network connect` é€£æ¥

### 2. è·¯ç”±å™¨ç«¯å£è½‰ç™¼

**å¦‚æœä½¿ç”¨ç«¯å£è½‰ç™¼**ï¼š
- ç¢ºä¿è·¯ç”±å™¨ç«¯å£è½‰ç™¼è¦å‰‡æ­£ç¢º
- ç¢ºä¿é˜²ç«ç‰†å…è¨±æµé‡é€šé
- æ¸¬è©¦ç«¯å£è½‰ç™¼æ˜¯å¦æ­£å¸¸

### 3. å…§éƒ¨ IP ç©©å®šæ€§

**ç¢ºä¿ä¼ºæœå™¨å…§éƒ¨ IP å›ºå®š**ï¼š
- ä½¿ç”¨ DHCP ä¿ç•™ï¼ˆåœ¨è·¯ç”±å™¨ä¸­è¨­å®šï¼‰
- æˆ–è¨­å®šéœæ…‹ IP

---

## ğŸ”„ éƒ¨ç½²æµç¨‹

### æ­¥é©Ÿ 1ï¼šç¢ºèªç¶²è·¯æ¶æ§‹

```bash
# åœ¨ä¼ºæœå™¨ä¸ŠåŸ·è¡Œ
# 1. ç¢ºèªå…§éƒ¨ IP
ip addr show

# 2. ç¢ºèªå®¹å™¨ç¶²è·¯
docker network ls
docker network inspect <network-name>

# 3. ç¢ºèªå®¹å™¨åç¨±
docker ps --format "{{.Names}}"
```

### æ­¥é©Ÿ 2ï¼šèª¿æ•´ config.yml

æ ¹æ“šå¯¦éš›ç¶²è·¯æ¶æ§‹èª¿æ•´æœå‹™åœ°å€ã€‚

### æ­¥é©Ÿ 3ï¼šé…ç½®è·¯ç”±å™¨ï¼ˆå¦‚éœ€è¦ï¼‰

```python
# ä½¿ç”¨è·¯ç”±å™¨ API é…ç½®ç«¯å£è½‰ç™¼
from router_full_control import RouterFullControl

router = RouterFullControl()
router.login()

# é…ç½®å¿…è¦çš„ç«¯å£è½‰ç™¼è¦å‰‡
# ...
```

### æ­¥é©Ÿ 4ï¼šéƒ¨ç½² Cloudflare Tunnel

```bash
# å•Ÿå‹•å®¹å™¨
docker run -d \
  --name wuchang-cloudflared \
  --restart unless-stopped \
  -v "$PWD/cloudflared/config.yml:/etc/cloudflared/config.yml:ro" \
  -v "$PWD/cloudflared/credentials.json:/etc/cloudflared/credentials.json:ro" \
  --network wuchang-network \
  cloudflare/cloudflared:latest tunnel run
```

### æ­¥é©Ÿ 5ï¼šé©—è­‰

- æª¢æŸ¥å®¹å™¨æ—¥èªŒ
- æ¸¬è©¦ HTTPS è¨ªå•
- æª¢æŸ¥è·¯ç”±å™¨ç‹€æ…‹

---

## ğŸ“‹ æª¢æŸ¥æ¸…å–®

### ç¶²è·¯é…ç½®
- [ ] ç¢ºèªä¼ºæœå™¨å…§éƒ¨ IP
- [ ] ç¢ºèªå®¹å™¨ç¶²è·¯é…ç½®
- [ ] ç¢ºèªå®¹å™¨åç¨±
- [ ] æ¸¬è©¦å®¹å™¨é–“é€£æ¥

### è·¯ç”±å™¨é…ç½®
- [ ] ç¢ºèª DDNS æ­£å¸¸é‹ä½œ
- [ ] é…ç½®ç«¯å£è½‰ç™¼ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] é…ç½®é˜²ç«ç‰†è¦å‰‡ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ¸¬è©¦è·¯ç”±å™¨é€£æ¥

### Cloudflare Tunnel é…ç½®
- [ ] èª¿æ•´ config.yml ä¸­çš„æœå‹™åœ°å€
- [ ] ç¢ºèªæ†‘è­‰æª”æ¡ˆæ­£ç¢º
- [ ] å•Ÿå‹•å®¹å™¨ä¸¦æª¢æŸ¥æ—¥èªŒ
- [ ] æ¸¬è©¦ HTTPS è¨ªå•

---

**å»ºç«‹æ™‚é–“**ï¼š2026-01-22
