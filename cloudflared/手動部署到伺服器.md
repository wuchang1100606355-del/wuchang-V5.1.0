# Cloudflare Tunnel æ‰‹å‹•éƒ¨ç½²åˆ°ä¼ºæœå™¨

**é©ç”¨æƒ…æ³**ï¼šè‡ªå‹•åŒæ­¥å¤±æ•—æˆ–éœ€è¦æ‰‹å‹•æ§åˆ¶éƒ¨ç½²éç¨‹

---

## ğŸ“‹ éœ€è¦éƒ¨ç½²çš„æª”æ¡ˆ

1. `cloudflared/config.yml` - Tunnel é…ç½®
2. `cloudflared/credentials.json` - Tunnel æ†‘è­‰ï¼ˆæ•æ„Ÿè³‡è¨Šï¼‰

---

## ğŸš€ æ‰‹å‹•éƒ¨ç½²æ­¥é©Ÿ

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ SCP å‚³è¼¸æª”æ¡ˆ

**åœ¨æœ¬åœ°åŸ·è¡Œ**ï¼š

```powershell
# ä½¿ç”¨ SCP å‚³è¼¸æª”æ¡ˆåˆ°ä¼ºæœå™¨
scp cloudflared/config.yml user@server:/path/to/wuchang-V5.1.0/cloudflared/
scp cloudflared/credentials.json user@server:/path/to/wuchang-V5.1.0/cloudflared/
```

**æˆ–ä½¿ç”¨ PowerShell çš„ SCP**ï¼š

```powershell
# ç¢ºä¿ç›®éŒ„å­˜åœ¨
ssh user@server "mkdir -p /path/to/wuchang-V5.1.0/cloudflared"

# å‚³è¼¸æª”æ¡ˆ
scp cloudflared/config.yml user@server:/path/to/wuchang-V5.1.0/cloudflared/
scp cloudflared/credentials.json user@server:/path/to/wuchang-V5.1.0/cloudflared/
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ Gitï¼ˆå¦‚æœå·²é…ç½®ï¼‰

**å¦‚æœä¼ºæœå™¨å¯ä»¥è¨ªå• Git å€‰åº«**ï¼š

```bash
# åœ¨ä¼ºæœå™¨ä¸ŠåŸ·è¡Œ
cd /path/to/wuchang-V5.1.0
git pull origin main

# æ³¨æ„ï¼šcredentials.json ä¸æ‡‰è©²æäº¤åˆ° Git
# éœ€è¦æ‰‹å‹•è¤‡è£½æˆ–ä½¿ç”¨å…¶ä»–æ–¹å¼å‚³è¼¸
```

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨å…±äº«ç›®éŒ„ï¼ˆSMB/NFSï¼‰

**å¦‚æœä¼ºæœå™¨å¯ä»¥è¨ªå•å…±äº«ç›®éŒ„**ï¼š

```powershell
# åœ¨æœ¬åœ°è¤‡è£½åˆ°å…±äº«ç›®éŒ„
Copy-Item cloudflared/config.yml "\\server\share\wuchang-V5.1.0\cloudflared\"
Copy-Item cloudflared/credentials.json "\\server\share\wuchang-V5.1.0\cloudflared\"
```

---

## ğŸ“ ä¼ºæœå™¨ç«¯éƒ¨ç½²å‘½ä»¤

**SSH åˆ°ä¼ºæœå™¨å¾ŒåŸ·è¡Œ**ï¼š

```bash
# 1. ç¢ºèªæª”æ¡ˆå·²å‚³è¼¸
cd /path/to/wuchang-V5.1.0
ls -la cloudflared/

# 2. è¨­å®šæª”æ¡ˆæ¬Šé™ï¼ˆcredentials.json æ˜¯æ•æ„Ÿæª”æ¡ˆï¼‰
chmod 600 cloudflared/credentials.json
chmod 644 cloudflared/config.yml

# 3. æª¢æŸ¥ä¸¦èª¿æ•´å®¹å™¨åç¨±ï¼ˆå¦‚éœ€è¦ï¼‰
# æŸ¥çœ‹ä¼ºæœå™¨ä¸Šçš„å®¹å™¨åç¨±
docker ps --format "{{.Names}}" | grep -E "caddy|wuchang"

# å¦‚æœå®¹å™¨åç¨±ä¸åŒï¼Œç·¨è¼¯ config.yml
nano cloudflared/config.yml
# å°‡ wuchangv510- æ”¹ç‚ºå¯¦éš›çš„å®¹å™¨åç¨±å‰ç¶´

# 4. åœæ­¢èˆŠå®¹å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
docker stop wuchang-cloudflared 2>/dev/null || true
docker rm wuchang-cloudflared 2>/dev/null || true

# 5. å•Ÿå‹• Cloudflare Tunnel å®¹å™¨
docker run -d \
  --name wuchang-cloudflared \
  --restart unless-stopped \
  -v "$PWD/cloudflared/config.yml:/etc/cloudflared/config.yml:ro" \
  -v "$PWD/cloudflared/credentials.json:/etc/cloudflared/credentials.json:ro" \
  --network wuchang-network \
  cloudflare/cloudflared:latest tunnel run

# 6. æª¢æŸ¥å®¹å™¨ç‹€æ…‹
docker ps --filter "name=cloudflared"

# 7. æª¢æŸ¥æ—¥èªŒ
docker logs wuchang-cloudflared --tail 50
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### 1. å®¹å™¨åç¨±å·®ç•°

**æœ¬åœ°é…ç½®**ï¼š
```yaml
service: http://wuchangv510-caddy-1:80
```

**ä¼ºæœå™¨å¯èƒ½éœ€è¦**ï¼š
```yaml
service: http://wuchang-caddy-1:80
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- åœ¨éƒ¨ç½²å‰æª¢æŸ¥ä¼ºæœå™¨ä¸Šçš„å®¹å™¨åç¨±
- æ‰‹å‹•ä¿®æ”¹ `config.yml` ä¸­çš„æœå‹™åç¨±

### 2. æ†‘è­‰æª”æ¡ˆå®‰å…¨

**`credentials.json` åŒ…å«æ•æ„Ÿè³‡è¨Š**ï¼š
- âš ï¸ ä½¿ç”¨å®‰å…¨çš„æ–¹å¼å‚³è¼¸ï¼ˆSCPã€åŠ å¯†å‚³è¼¸ç­‰ï¼‰
- âš ï¸ ç¢ºä¿æª”æ¡ˆæ¬Šé™æ­£ç¢ºï¼ˆ600ï¼‰
- âš ï¸ ä¸è¦æäº¤åˆ° Git

### 3. Docker ç¶²è·¯é…ç½®

**ç¢ºä¿å®¹å™¨åœ¨åŒä¸€ç¶²è·¯ä¸­**ï¼š

```bash
# æª¢æŸ¥ç¶²è·¯
docker network ls

# å¦‚æœç¶²è·¯ä¸å­˜åœ¨ï¼Œå»ºç«‹ç¶²è·¯
docker network create wuchang-network

# æˆ–ä½¿ç”¨ç¾æœ‰çš„ç¶²è·¯åç¨±
```

---

## âœ… é©—è­‰æ­¥é©Ÿ

### 1. æª¢æŸ¥æª”æ¡ˆ

```bash
ls -la cloudflared/
# æ‡‰è©²çœ‹åˆ° config.yml å’Œ credentials.json
```

### 2. æª¢æŸ¥å®¹å™¨ç‹€æ…‹

```bash
docker ps --filter "name=cloudflared"
# æ‡‰è©²é¡¯ç¤ºé‹è¡Œä¸­çš„å®¹å™¨
```

### 3. æª¢æŸ¥æ—¥èªŒ

```bash
docker logs wuchang-cloudflared --tail 30
# æ‡‰è©²çœ‹åˆ° "Registered tunnel connection"
```

### 4. æ¸¬è©¦ HTTPS è¨ªå•

åœ¨ç€è¦½å™¨è¨ªå•ï¼š
- https://wuchang.life
- https://www.wuchang.life

---

## ğŸ”§ æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼šæª”æ¡ˆå‚³è¼¸å¤±æ•—

**æª¢æŸ¥**ï¼š
- SSH é€£æ¥æ˜¯å¦æ­£å¸¸
- æª”æ¡ˆè·¯å¾‘æ˜¯å¦æ­£ç¢º
- æ¬Šé™æ˜¯å¦è¶³å¤ 

### å•é¡Œ 2ï¼šå®¹å™¨ç„¡æ³•å•Ÿå‹•

**æª¢æŸ¥**ï¼š
- æª”æ¡ˆæ˜¯å¦å­˜åœ¨
- æª”æ¡ˆæ¬Šé™æ˜¯å¦æ­£ç¢º
- Docker ç¶²è·¯æ˜¯å¦é…ç½®

### å•é¡Œ 3ï¼šç„¡æ³•é€£æ¥åˆ°æœå‹™

**æª¢æŸ¥**ï¼š
- å®¹å™¨åç¨±æ˜¯å¦æ­£ç¢º
- æœå‹™å®¹å™¨æ˜¯å¦é‹è¡Œ
- Docker ç¶²è·¯æ˜¯å¦æ­£ç¢º

---

**å»ºç«‹æ™‚é–“**ï¼š2026-01-22
