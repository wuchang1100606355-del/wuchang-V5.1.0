# Cloudflare Tunnel é›™ç¶²å¡é…ç½®æŒ‡å—

**é‡è¦**ï¼šä¼ºæœå™¨ç‚ºé›™ç¶²å¡ï¼Œæœ‰å…©å€‹å…§éƒ¨ IPã€‚

---

## ğŸ“‹ é›™ç¶²å¡æ¶æ§‹èªªæ˜

### ç¶²è·¯æ¶æ§‹
- **ç¶²å¡ 1**ï¼šå…§éƒ¨ IP 1ï¼ˆéœ€è¦ç¢ºèªï¼‰
- **ç¶²å¡ 2**ï¼šå…§éƒ¨ IP 2ï¼ˆéœ€è¦ç¢ºèªï¼‰
- **è·¯ç”±å™¨å…§éƒ¨ IP**ï¼š`192.168.50.84`
- **è·¯ç”±å™¨å¤–éƒ¨ IP**ï¼š`220.135.21.74`

### é…ç½®è€ƒé‡
1. **æœå‹™åˆ†é…**ï¼šä¸åŒæœå‹™å¯èƒ½ä½¿ç”¨ä¸åŒçš„ç¶²å¡
2. **è² è¼‰å‡è¡¡**ï¼šå¯ä»¥å°‡æœå‹™åˆ†æ•£åˆ°å…©å€‹ç¶²å¡
3. **å®¹éŒ¯å‚™æ´**ï¼šä¸€å€‹ç¶²å¡æ•…éšœæ™‚ï¼Œå¦ä¸€å€‹å¯ä»¥æ¥æ›¿

---

## ğŸ”§ é…ç½®é¸é …

### é¸é … Aï¼šä¸»è¦ç¶²å¡ï¼ˆæ¨è–¦ï¼‰

**æ‰€æœ‰æœå‹™ä½¿ç”¨åŒä¸€å€‹ä¸»è¦ç¶²å¡**ï¼š

```yaml
ingress:
  - hostname: wuchang.life
    service: http://192.168.50.249:80  # ä¸»è¦ç¶²å¡ IP
```

### é¸é … Bï¼šæœå‹™åˆ†æ•£

**ä¸åŒæœå‹™ä½¿ç”¨ä¸åŒçš„ç¶²å¡**ï¼š

```yaml
ingress:
  # ä¸»è¦æœå‹™ä½¿ç”¨ç¶²å¡ 1
  - hostname: wuchang.life
    service: http://192.168.50.249:80  # ç¶²å¡ 1
  
  # æ¬¡è¦æœå‹™ä½¿ç”¨ç¶²å¡ 2
  - hostname: app.wuchang.org.tw
    service: http://192.168.50.XXX:8069  # ç¶²å¡ 2
```

### é¸é … Cï¼šå®¹éŒ¯é…ç½®

**ä½¿ç”¨å¤šå€‹ ingress è¦å‰‡å¯¦ç¾å®¹éŒ¯**ï¼š

```yaml
ingress:
  # ä¸»è¦è·¯å¾‘ï¼ˆç¶²å¡ 1ï¼‰
  - hostname: wuchang.life
    service: http://192.168.50.249:80
  
  # å‚™æ´è·¯å¾‘ï¼ˆç¶²å¡ 2ï¼Œå¦‚æœç¶²å¡ 1 å¤±æ•—ï¼‰
  - hostname: wuchang.life
    service: http://192.168.50.XXX:80
    originRequest:
      failoverTimeout: 10s
```

---

## ğŸš€ é…ç½®æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šç¢ºèªå…©å€‹å…§éƒ¨ IP

**åœ¨ä¼ºæœå™¨ä¸ŠåŸ·è¡Œ**ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰ç¶²å¡å’Œ IP
ip addr show

# æˆ–
ifconfig

# æ‡‰è©²çœ‹åˆ°é¡ä¼¼ï¼š
# eth0: 192.168.50.249
# eth1: 192.168.50.XXX
```

### æ­¥é©Ÿ 2ï¼šç¢ºèªæœå‹™ç¶å®š

**ç¢ºèªæ¯å€‹æœå‹™ç¶å®šåˆ°å“ªå€‹ç¶²å¡**ï¼š

```bash
# æª¢æŸ¥æœå‹™ç›£è½çš„ IP
netstat -tuln | grep LISTEN

# æˆ–
ss -tuln | grep LISTEN
```

### æ­¥é©Ÿ 3ï¼šæ›´æ–° config.yml

æ ¹æ“šå¯¦éš›æƒ…æ³é¸æ“‡é…ç½®é¸é …ã€‚

---

## ğŸ“ é…ç½®ç¯„ä¾‹

### ç¯„ä¾‹ 1ï¼šæ‰€æœ‰æœå‹™ä½¿ç”¨ä¸»è¦ç¶²å¡

```yaml
tunnel: 837487dd-1536-43ec-a1c9-ee366a0aa4b7
credentials-file: /etc/cloudflared/credentials.json

ingress:
  # æ‰€æœ‰æœå‹™ä½¿ç”¨ä¸»è¦ç¶²å¡ IP
  - hostname: wuchang.life
    service: http://192.168.50.249:80
  
  - hostname: www.wuchang.life
    service: http://192.168.50.249:80
  
  - hostname: app.wuchang.org.tw
    service: http://192.168.50.249:8069
  
  - hostname: ai.wuchang.org.tw
    service: http://192.168.50.249:8080
  
  - hostname: admin.wuchang.org.tw
    service: http://192.168.50.249:9000
  
  - hostname: monitor.wuchang.org.tw
    service: http://192.168.50.249:3001
  
  - service: http_status:404
```

### ç¯„ä¾‹ 2ï¼šæœå‹™åˆ†æ•£åˆ°å…©å€‹ç¶²å¡

```yaml
tunnel: 837487dd-1536-43ec-a1c9-ee366a0aa4b7
credentials-file: /etc/cloudflared/credentials.json

ingress:
  # ä¸»è¦æœå‹™ä½¿ç”¨ç¶²å¡ 1 (192.168.50.249)
  - hostname: wuchang.life
    service: http://192.168.50.249:80
  
  - hostname: www.wuchang.life
    service: http://192.168.50.249:80
  
  # æ¬¡è¦æœå‹™ä½¿ç”¨ç¶²å¡ 2 (192.168.50.XXX)
  - hostname: app.wuchang.org.tw
    service: http://192.168.50.XXX:8069
  
  - hostname: ai.wuchang.org.tw
    service: http://192.168.50.XXX:8080
  
  - hostname: admin.wuchang.org.tw
    service: http://192.168.50.249:9000
  
  - hostname: monitor.wuchang.org.tw
    service: http://192.168.50.249:3001
  
  - service: http_status:404
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### 1. æœå‹™ç¶å®šç¢ºèª

**ç¢ºä¿æœå‹™ç¶å®šåˆ°æ­£ç¢ºçš„ IP**ï¼š

```bash
# æª¢æŸ¥ Caddy ç¶å®š
curl http://192.168.50.249:80
curl http://192.168.50.XXX:80

# æª¢æŸ¥å…¶ä»–æœå‹™...
```

### 2. è·¯ç”±å™¨è·¯ç”±é…ç½®

**ç¢ºä¿è·¯ç”±å™¨å¯ä»¥è·¯ç”±åˆ°å…©å€‹ IP**ï¼š

- å…©å€‹ IP éƒ½æ‡‰è©²åœ¨è·¯ç”±å™¨çš„å…§éƒ¨ç¶²è·¯ä¸­
- è·¯ç”±å™¨æ‡‰è©²èƒ½å¤ è¨ªå•å…©å€‹ IP
- å¯èƒ½éœ€è¦é…ç½®éœæ…‹è·¯ç”±ï¼ˆå¦‚æœä½¿ç”¨ä¸åŒç¶²æ®µï¼‰

### 3. é˜²ç«ç‰†è¦å‰‡

**ç¢ºä¿å…©å€‹ç¶²å¡çš„é˜²ç«ç‰†è¦å‰‡æ­£ç¢º**ï¼š

```bash
# æª¢æŸ¥é˜²ç«ç‰†è¦å‰‡
iptables -L -n

# æˆ–
firewall-cmd --list-all
```

---

## ğŸ” è¨ºæ–·å·¥å…·

### æª¢æŸ¥ç¶²å¡ç‹€æ…‹

```bash
# æŸ¥çœ‹ç¶²å¡è³‡è¨Š
ip link show

# æŸ¥çœ‹ IP é…ç½®
ip addr show

# æŸ¥çœ‹è·¯ç”±è¡¨
ip route show
```

### æ¸¬è©¦é€£æ¥

```bash
# å¾ Cloudflare Tunnel å®¹å™¨æ¸¬è©¦
docker exec wuchang-cloudflared ping -c 3 192.168.50.249
docker exec wuchang-cloudflared ping -c 3 192.168.50.XXX

# æ¸¬è©¦æœå‹™é€£æ¥
docker exec wuchang-cloudflared wget -O- http://192.168.50.249:80
docker exec wuchang-cloudflared wget -O- http://192.168.50.XXX:80
```

---

## ğŸ“‹ é…ç½®æª¢æŸ¥æ¸…å–®

- [ ] ç¢ºèªå…©å€‹å…§éƒ¨ IP åœ°å€
- [ ] ç¢ºèªæ¯å€‹æœå‹™ç¶å®šåˆ°å“ªå€‹ IP
- [ ] é¸æ“‡é…ç½®é¸é …ï¼ˆä¸»è¦ç¶²å¡ / æœå‹™åˆ†æ•£ / å®¹éŒ¯ï¼‰
- [ ] æ›´æ–° config.yml
- [ ] æ¸¬è©¦å…©å€‹ IP çš„é€£æ¥
- [ ] ç¢ºèªè·¯ç”±å™¨å¯ä»¥è¨ªå•å…©å€‹ IP
- [ ] éƒ¨ç½²ä¸¦é©—è­‰

---

**å»ºç«‹æ™‚é–“**ï¼š2026-01-22
