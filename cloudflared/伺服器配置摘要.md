# Cloudflare Tunnel ä¼ºæœå™¨é…ç½®æ‘˜è¦

**æ›´æ–°æ™‚é–“**ï¼š2026-01-22  
**ä¼ºæœå™¨å…§éƒ¨ IP**ï¼š`192.168.50.249`

---

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. config.yml å·²æ›´æ–°

æ‰€æœ‰æœå‹™åœ°å€å·²æ›´æ–°ç‚ºä½¿ç”¨ä¼ºæœå™¨å…§éƒ¨ IPï¼š

```yaml
ingress:
  # é¦–é ï¼ˆæ ¹åŸŸåï¼‰
  - hostname: wuchang.life
    service: http://192.168.50.249:80
  
  # é¦–é ï¼ˆWWW å­åŸŸåï¼‰
  - hostname: www.wuchang.life
    service: http://192.168.50.249:80
  
  # Odoo ERP ç³»çµ±
  - hostname: app.wuchang.org.tw
    service: http://192.168.50.249:8069
  
  # Open WebUI (AI ä»‹é¢)
  - hostname: ai.wuchang.org.tw
    service: http://192.168.50.249:8080
  
  # Portainer (å®¹å™¨ç®¡ç†)
  - hostname: admin.wuchang.org.tw
    service: http://192.168.50.249:9000
  
  # Uptime Kuma (ç›£æ§)
  - hostname: monitor.wuchang.org.tw
    service: http://192.168.50.249:3001
```

### 2. è·¯ç”±å™¨æ¥æ›¿é…ç½®

**ç¶²è·¯æ¶æ§‹**ï¼š
- è·¯ç”±å™¨å¤–éƒ¨ IPï¼š`220.135.21.74`
- è·¯ç”±å™¨å…§éƒ¨ IPï¼š`192.168.50.84`
- ä¼ºæœå™¨å…§éƒ¨ IPï¼š`192.168.50.249`
- Cloudflare Tunnel å¯ç›´æ¥è¨ªå•ä¼ºæœå™¨å…§éƒ¨ IP

---

## ğŸ“‹ æœå‹™ç«¯å£å°æ‡‰

| æœå‹™ | å…§éƒ¨ç«¯å£ | èªªæ˜ |
|------|---------|------|
| Caddy (é¦–é ) | 80 | wuchang.life, www.wuchang.life |
| Odoo ERP | 8069 | app.wuchang.org.tw |
| Open WebUI | 8080 | ai.wuchang.org.tw |
| Portainer | 9000 | admin.wuchang.org.tw |
| Uptime Kuma | 3001 | monitor.wuchang.org.tw |

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### 1. è·¯ç”±å™¨ç«¯å£è½‰ç™¼ï¼ˆå¯é¸ï¼‰

**å¦‚æœ Cloudflare Tunnel å®¹å™¨ç„¡æ³•ç›´æ¥è¨ªå• `192.168.50.249`**ï¼Œå¯èƒ½éœ€è¦é…ç½®è·¯ç”±å™¨ç«¯å£è½‰ç™¼ï¼š

```python
from router_full_control import RouterFullControl

router = RouterFullControl()
router.login()

# é…ç½®ç«¯å£è½‰ç™¼ï¼ˆå¦‚éœ€è¦ï¼‰
router.add_port_forwarding_rule(
    external_port=80,
    internal_ip="192.168.50.249",
    internal_port=80,
    protocol="TCP",
    description="Cloudflare Tunnel - Caddy"
)
```

### 2. é˜²ç«ç‰†è¦å‰‡

**ç¢ºä¿è·¯ç”±å™¨å…è¨±å…§éƒ¨æµé‡**ï¼š
- Cloudflare Tunnel å®¹å™¨éœ€è¦èƒ½å¤ è¨ªå• `192.168.50.249`
- ç¢ºä¿è·¯ç”±å™¨é˜²ç«ç‰†å…è¨±å…§éƒ¨ç¶²è·¯æµé‡

### 3. ä¼ºæœå™¨æœå‹™ç‹€æ…‹

**ç¢ºä¿ä¼ºæœå™¨ä¸Šçš„æœå‹™æ­£åœ¨é‹è¡Œ**ï¼š

```bash
# åœ¨ä¼ºæœå™¨ä¸Šæª¢æŸ¥æœå‹™ç‹€æ…‹
# æª¢æŸ¥ Caddy
curl http://192.168.50.249:80

# æª¢æŸ¥ Odoo
curl http://192.168.50.249:8069

# æª¢æŸ¥å…¶ä»–æœå‹™...
```

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šåŒæ­¥é…ç½®åˆ°ä¼ºæœå™¨

```powershell
# ä½¿ç”¨æª”æ¡ˆåŒæ­¥ï¼ˆå¦‚æœå¥åº·æª¢æŸ¥é€šéï¼‰
python dual_j_file_sync_with_dns_replace.py --files cloudflared/config.yml cloudflared/credentials.json

# æˆ–æ‰‹å‹•å‚³è¼¸
scp cloudflared/config.yml user@server:/path/to/wuchang-V5.1.0/cloudflared/
scp cloudflared/credentials.json user@server:/path/to/wuchang-V5.1.0/cloudflared/
```

### æ­¥é©Ÿ 2ï¼šåœ¨ä¼ºæœå™¨ä¸Šéƒ¨ç½²

```bash
# SSH åˆ°ä¼ºæœå™¨
ssh user@server

# ç¢ºèªæª”æ¡ˆå·²åŒæ­¥
cd /path/to/wuchang-V5.1.0
ls -la cloudflared/

# è¨­å®šæª”æ¡ˆæ¬Šé™
chmod 600 cloudflared/credentials.json
chmod 644 cloudflared/config.yml

# å•Ÿå‹• Cloudflare Tunnel å®¹å™¨
docker run -d \
  --name wuchang-cloudflared \
  --restart unless-stopped \
  -v "$PWD/cloudflared/config.yml:/etc/cloudflared/config.yml:ro" \
  -v "$PWD/cloudflared/credentials.json:/etc/cloudflared/credentials.json:ro" \
  --network host \
  cloudflare/cloudflared:latest tunnel run
```

**æ³¨æ„**ï¼šä½¿ç”¨ `--network host` è®“å®¹å™¨å¯ä»¥ç›´æ¥è¨ªå• `192.168.50.249`

### æ­¥é©Ÿ 3ï¼šé©—è­‰é€£æ¥

```bash
# æª¢æŸ¥å®¹å™¨æ—¥èªŒ
docker logs wuchang-cloudflared --tail 50

# æ‡‰è©²çœ‹åˆ°ï¼š
# Starting tunnel tunnelID=837487dd-1536-43ec-a1c9-ee366a0aa4b7
# Registered tunnel connection connIndex=0 location=...
```

### æ­¥é©Ÿ 4ï¼šæ¸¬è©¦ HTTPS è¨ªå•

åœ¨ç€è¦½å™¨è¨ªå•ï¼š
- https://wuchang.life
- https://www.wuchang.life

---

## ğŸ”§ æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼šç„¡æ³•é€£æ¥åˆ° 192.168.50.249

**æª¢æŸ¥**ï¼š
```bash
# åœ¨ Cloudflare Tunnel å®¹å™¨ä¸­æ¸¬è©¦
docker exec wuchang-cloudflared ping -c 3 192.168.50.249

# å¦‚æœç„¡æ³• pingï¼Œæª¢æŸ¥ï¼š
# 1. ä¼ºæœå™¨æ˜¯å¦åœ¨åŒä¸€ç¶²è·¯
# 2. è·¯ç”±å™¨é˜²ç«ç‰†è¦å‰‡
# 3. ä½¿ç”¨ --network host å•Ÿå‹•å®¹å™¨
```

### å•é¡Œ 2ï¼šæœå‹™ç„¡æ³•è¨ªå•

**æª¢æŸ¥**ï¼š
```bash
# åœ¨ä¼ºæœå™¨ä¸Šæª¢æŸ¥æœå‹™
curl http://192.168.50.249:80
curl http://192.168.50.249:8069

# æª¢æŸ¥æœå‹™æ˜¯å¦æ­£åœ¨é‹è¡Œ
docker ps --filter "name=caddy"
docker ps --filter "name=odoo"
```

### å•é¡Œ 3ï¼šTunnel é€£æ¥å¤±æ•—

**æª¢æŸ¥**ï¼š
- `credentials.json` æ˜¯å¦æ­£ç¢º
- Tunnel ID æ˜¯å¦æ­£ç¢º
- ç¶²è·¯é€£æ¥æ˜¯å¦æ­£å¸¸

---

## âœ… é…ç½®æª¢æŸ¥æ¸…å–®

- [x] config.yml å·²æ›´æ–°ç‚ºä½¿ç”¨ `192.168.50.249`
- [ ] é…ç½®æª”æ¡ˆå·²åŒæ­¥åˆ°ä¼ºæœå™¨
- [ ] æ†‘è­‰æª”æ¡ˆå·²åŒæ­¥åˆ°ä¼ºæœå™¨
- [ ] ä¼ºæœå™¨ä¸Šçš„æœå‹™æ­£åœ¨é‹è¡Œ
- [ ] Cloudflare Tunnel å®¹å™¨å·²å•Ÿå‹•
- [ ] å®¹å™¨å¯ä»¥è¨ªå• `192.168.50.249`
- [ ] Tunnel é€£æ¥æˆåŠŸ
- [ ] HTTPS è¨ªå•æ­£å¸¸

---

**å»ºç«‹æ™‚é–“**ï¼š2026-01-22  
**ç‹€æ…‹**ï¼šâœ… config.yml å·²æ›´æ–°ï¼Œç­‰å¾…éƒ¨ç½²åˆ°ä¼ºæœå™¨
