<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é›™è¢å¹•å•Ÿå‹•å™¨ - äº”å¸¸æ§åˆ¶ä¸­å¿ƒ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: #333;
      margin-bottom: 8px;
      font-size: 28px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 32px;
      font-size: 14px;
    }
    .screen-info {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 24px;
    }
    .screen-item {
      padding: 12px;
      margin-bottom: 8px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
    }
    .screen-item:last-child {
      margin-bottom: 0;
    }
    .screen-label {
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
    }
    .screen-details {
      font-size: 12px;
      color: #666;
    }
    .btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 12px;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    .btn:active {
      transform: translateY(0);
    }
    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }
    .btn-secondary:hover {
      background: #e0e0e0;
    }
    .status {
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }
    .status.success {
      background: #d1e7dd;
      color: #0f5132;
      border: 1px solid #badbcc;
    }
    .status.error {
      background: #f8d7da;
      color: #842029;
      border: 1px solid #f5c2c7;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ–¥ï¸ é›™è¢å¹•å•Ÿå‹•å™¨</h1>
    <div class="subtitle">åœ¨å…©å€‹è¢å¹•ä¸Šåˆ†åˆ¥æ‰“é–‹å…¨è¢å¹•æ§åˆ¶ä¸­å¿ƒ</div>
    
    <div class="screen-info">
      <div class="screen-label">åµæ¸¬åˆ°çš„è¢å¹•ï¼š</div>
      <div id="screenList"></div>
    </div>
    
    <button class="btn" id="btnLaunchDualScreen">å•Ÿå‹•é›™è¢å¹•æ¨¡å¼</button>
    <button class="btn btn-secondary" id="btnCloseAll">é—œé–‰æ‰€æœ‰è¦–çª—</button>
    
    <div id="status" class="status"></div>
  </div>

  <script>
    let openedWindows = [];

    // åµæ¸¬è¢å¹•è³‡è¨Š
    function detectScreens() {
      const screens = [];
      
      // ä½¿ç”¨ Screen API
      if (window.screen) {
        screens.push({
          id: 'primary',
          label: 'ä¸»è¢å¹•',
          width: window.screen.width,
          height: window.screen.height,
          availWidth: window.screen.availWidth,
          availHeight: window.screen.availHeight,
          left: window.screen.left || 0,
          top: window.screen.top || 0
        });
      }
      
      // å˜—è©¦ä½¿ç”¨ Multi-Screen Window Placement APIï¼ˆå¦‚æœå¯ç”¨ï¼‰
      if ('getScreenDetails' in window) {
        window.getScreenDetails().then(screenDetails => {
          screenDetails.screens.forEach((screen, index) => {
            screens.push({
              id: `screen_${index}`,
              label: index === 0 ? 'ä¸»è¢å¹•' : `è¢å¹• ${index + 1}`,
              width: screen.width,
              height: screen.height,
              availWidth: screen.availWidth,
              availHeight: screen.availHeight,
              left: screen.left,
              top: screen.top
            });
          });
          updateScreenList(screens);
        }).catch(() => {
          // å¦‚æœä¸æ”¯æ´ï¼Œä½¿ç”¨åŸºæœ¬è³‡è¨Š
          updateScreenList(screens);
        });
      } else {
        // åŸºæœ¬æ¨¡å¼ï¼šå‡è¨­æœ‰å…©å€‹è¢å¹•ï¼ˆä¸»è¢å¹• + ç¬¬äºŒè¢å¹•ï¼‰
        screens.push({
          id: 'screen_2',
          label: 'ç¬¬äºŒè¢å¹•ï¼ˆé è¨­ï¼‰',
          width: window.screen.width,
          height: window.screen.height,
          availWidth: window.screen.availWidth,
          availHeight: window.screen.availHeight,
          left: window.screen.width, // å‡è¨­ç¬¬äºŒè¢å¹•åœ¨ä¸»è¢å¹•å³å´
          top: 0
        });
        updateScreenList(screens);
      }
      
      return screens;
    }

    function updateScreenList(screens) {
      const list = document.getElementById('screenList');
      if (screens.length === 0) {
        list.innerHTML = '<div class="screen-item">ç„¡æ³•åµæ¸¬è¢å¹•è³‡è¨Š</div>';
        return;
      }
      
      list.innerHTML = screens.map(screen => `
        <div class="screen-item">
          <div class="screen-label">${screen.label}</div>
          <div class="screen-details">
            è§£æåº¦: ${screen.width} Ã— ${screen.height}<br>
            å¯ç”¨å€åŸŸ: ${screen.availWidth} Ã— ${screen.availHeight}<br>
            ä½ç½®: (${screen.left}, ${screen.top})
          </div>
        </div>
      `).join('');
    }

    // åœ¨æŒ‡å®šè¢å¹•ä¸Šæ‰“é–‹å…¨è¢å¹•è¦–çª—
    function openFullscreenOnScreen(screenIndex, screenInfo) {
      const url = window.location.origin + '/';
      const features = [
        'fullscreen=yes',
        `width=${screenInfo.availWidth}`,
        `height=${screenInfo.availHeight}`,
        `left=${screenInfo.left}`,
        `top=${screenInfo.top}`,
        'menubar=no',
        'toolbar=no',
        'location=no',
        'status=no',
        'resizable=yes',
        'scrollbars=yes'
      ].join(',');
      
      const win = window.open(url, `wuchang_screen_${screenIndex}`, features);
      
      if (win) {
        openedWindows.push(win);
        
        // ç­‰å¾…è¦–çª—è¼‰å…¥å¾Œé€²å…¥å…¨è¢å¹•
        win.addEventListener('load', () => {
          setTimeout(() => {
            try {
              if (win.document.documentElement.requestFullscreen) {
                win.document.documentElement.requestFullscreen();
              } else if (win.document.documentElement.webkitRequestFullscreen) {
                win.document.documentElement.webkitRequestFullscreen();
              } else if (win.document.documentElement.msRequestFullscreen) {
                win.document.documentElement.msRequestFullscreen();
              }
            } catch (e) {
              console.warn('ç„¡æ³•é€²å…¥å…¨è¢å¹•:', e);
            }
          }, 500);
        });
      }
      
      return win;
    }

    // å•Ÿå‹•é›™è¢å¹•æ¨¡å¼
    async function launchDualScreen() {
      const statusDiv = document.getElementById('status');
      statusDiv.style.display = 'none';
      
      try {
        // åµæ¸¬è¢å¹•
        const screens = detectScreens();
        
        if (screens.length < 2) {
          // å¦‚æœåªåµæ¸¬åˆ°ä¸€å€‹è¢å¹•ï¼Œä½¿ç”¨é è¨­é…ç½®
          screens.push({
            id: 'screen_2',
            label: 'ç¬¬äºŒè¢å¹•ï¼ˆé è¨­ï¼‰',
            width: window.screen.width,
            height: window.screen.height,
            availWidth: window.screen.availWidth,
            availHeight: window.screen.availHeight,
            left: window.screen.width,
            top: 0
          });
        }
        
        // åœ¨ä¸»è¢å¹•ä¸Šæ‰“é–‹ç¬¬ä¸€å€‹è¦–çª—
        const screen1 = screens[0];
        const win1 = openFullscreenOnScreen(1, screen1);
        
        // ç­‰å¾…ä¸€ä¸‹å†æ‰“é–‹ç¬¬äºŒå€‹è¦–çª—
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // åœ¨ç¬¬äºŒè¢å¹•ä¸Šæ‰“é–‹ç¬¬äºŒå€‹è¦–çª—
        const screen2 = screens[1] || screens[0];
        const win2 = openFullscreenOnScreen(2, {
          ...screen2,
          left: screen2.left || window.screen.width
        });
        
        if (win1 && win2) {
          showStatus('success', 'âœ… å·²å•Ÿå‹•é›™è¢å¹•æ¨¡å¼ï¼å…©å€‹è¦–çª—å·²åˆ†åˆ¥æ‰“é–‹ã€‚');
        } else {
          showStatus('error', 'âŒ ç„¡æ³•æ‰“é–‹è¦–çª—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨å½ˆå‡ºè¦–çª—è¨­å®šã€‚');
        }
      } catch (e) {
        showStatus('error', `âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š${String(e)}`);
      }
    }

    // é—œé–‰æ‰€æœ‰è¦–çª—
    function closeAllWindows() {
      openedWindows.forEach(win => {
        try {
          if (win && !win.closed) {
            win.close();
          }
        } catch (e) {
          console.warn('ç„¡æ³•é—œé–‰è¦–çª—:', e);
        }
      });
      openedWindows = [];
      showStatus('success', 'å·²é—œé–‰æ‰€æœ‰è¦–çª—');
    }

    function showStatus(type, message) {
      const statusDiv = document.getElementById('status');
      statusDiv.className = `status ${type}`;
      statusDiv.textContent = message;
      statusDiv.style.display = 'block';
    }

    // äº‹ä»¶ç¶å®š
    document.getElementById('btnLaunchDualScreen').addEventListener('click', launchDualScreen);
    document.getElementById('btnCloseAll').addEventListener('click', closeAllWindows);

    // åˆå§‹è¼‰å…¥
    detectScreens();
  </script>
</body>
</html>
