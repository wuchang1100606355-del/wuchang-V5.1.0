# 雙網卡特殊運用場景分析

**伺服器配置**：server（有線）+ server 2（WiFi）  
**更新時間**：2026-01-22

---

## 🎯 雙網卡優勢

### 1. **網路冗餘與容錯**
- 當一個網卡故障時，自動切換到另一個
- 提高系統可用性和穩定性

### 2. **流量分流與負載均衡**
- 將不同服務分散到不同網卡
- 避免單一網卡成為瓶頸

### 3. **網路隔離與安全**
- 不同網卡連接不同網路
- 實現服務隔離和安全分層

---

## 💡 特殊運用場景

### 場景 1：服務分層架構

**配置**：
- **身份 1（server - 有線）**：對外服務
  - wuchang.life（首頁）
  - app.wuchang.org.tw（Odoo ERP）
  - ai.wuchang.org.tw（Open WebUI）
  
- **身份 2（server 2 - WiFi）**：內部管理服務
  - admin.wuchang.org.tw（Portainer）
  - monitor.wuchang.org.tw（Uptime Kuma）
  - 內部測試環境

**優勢**：
- 對外服務使用穩定的有線連接
- 內部管理服務使用 WiFi，減少對主要網路的影響
- 實現服務分層和優先級管理

---

### 場景 2：容錯備援架構

**配置**：
- **身份 1（有線）**：主要服務路徑
- **身份 2（WiFi）**：備援服務路徑

**Cloudflare Tunnel 配置**：
```yaml
ingress:
  # 主要路徑（身份 1）
  - hostname: wuchang.life
    service: http://192.168.50.249:80
  
  # 備援路徑（身份 2）
  - hostname: wuchang.life
    service: http://192.168.50.XXX:80  # 身份 2 IP
    originRequest:
      failoverTimeout: 10s
      retries:
        maxRetries: 3
```

**優勢**：
- 當有線網卡故障時，自動切換到 WiFi
- 實現零停機時間
- 提高服務可用性

---

### 場景 3：網路隔離架構

**配置**：
- **身份 1（有線）**：連接主要網路（192.168.50.x）
  - 提供對外服務
  - 與路由器直接連接

- **身份 2（WiFi）**：連接 IoT 網路（work_IoT）
  - 內部管理服務
  - 與 IoT 設備隔離

**優勢**：
- 實現網路隔離，提高安全性
- IoT 設備無法直接訪問主要服務
- 符合安全最佳實踐

---

### 場景 4：流量分流與 QoS

**配置**：
- **身份 1（有線）**：高優先級服務
  - 用戶訪問的網站
  - 關鍵業務系統
  
- **身份 2（WiFi）**：低優先級服務
  - 備份任務
  - 測試環境
  - 監控服務

**優勢**：
- 確保關鍵服務的網路品質
- 避免低優先級服務影響主要服務
- 實現 QoS（服務品質）管理

---

### 場景 5：開發與生產環境分離

**配置**：
- **身份 1（有線）**：生產環境
  - 正式對外服務
  - 穩定可靠的有線連接

- **身份 2（WiFi）**：開發/測試環境
  - 開發中的功能測試
  - 不影響生產環境

**優勢**：
- 開發和生產環境完全隔離
- 開發測試不影響生產服務
- 提高開發效率和安全性

---

### 場景 6：多租戶架構

**配置**：
- **身份 1（有線）**：協會主要服務
  - wuchang.life
  - Odoo ERP
  
- **身份 2（WiFi）**：合作夥伴或租戶服務
  - 重新店專用服務
  - 其他合作夥伴服務

**優勢**：
- 不同租戶使用不同網卡
- 實現資源隔離和計費分離
- 符合多租戶架構需求

---

### 場景 7：監控與管理分離

**配置**：
- **身份 1（有線）**：業務服務
  - 用戶訪問的網站和應用
  
- **身份 2（WiFi）**：監控和管理
  - Portainer（容器管理）
  - Uptime Kuma（監控）
  - 系統日誌收集

**優勢**：
- 監控流量不影響業務服務
- 管理操作與業務分離
- 提高系統可維護性

---

## 🔧 實施建議

### 1. Cloudflare Tunnel 配置

**選項 A：所有服務使用身份 1（當前）**
```yaml
ingress:
  - hostname: wuchang.life
    service: http://192.168.50.249:80
```

**選項 B：服務分散到兩個身份**
```yaml
ingress:
  # 身份 1 的服務
  - hostname: wuchang.life
    service: http://192.168.50.249:80
  
  # 身份 2 的服務
  - hostname: admin.wuchang.org.tw
    service: http://192.168.50.XXX:9000
```

**選項 C：容錯配置**
```yaml
ingress:
  - hostname: wuchang.life
    service: http://192.168.50.249:80
  - hostname: wuchang.life
    service: http://192.168.50.XXX:80
    originRequest:
      failoverTimeout: 10s
```

### 2. Odoo 路由器管理

- 在 Odoo 中建立兩個伺服器身份記錄
- 關聯到對應的設備記錄
- 記錄每個身份提供的服務
- 設定服務分配策略

### 3. 路由器配置

- 確保兩個網卡都獲得固定 IP
- 設定端口轉發規則（如需要）
- 配置 QoS 規則（如需要）

---

## 📊 場景選擇建議

### 當前建議：**場景 1（服務分層架構）**

**理由**：
1. 有線連接穩定，適合對外服務
2. WiFi 連接適合內部管理服務
3. 實現服務分層，提高可維護性
4. 符合當前網路架構（work_IoT 網路）

**配置**：
- 身份 1（有線）：wuchang.life, app.wuchang.org.tw, ai.wuchang.org.tw
- 身份 2（WiFi）：admin.wuchang.org.tw, monitor.wuchang.org.tw

---

## ⚠️ 注意事項

### 1. 身份 2 的 IPv4 地址
- 目前只顯示 IPv6，需要確認 IPv4
- 在路由器或伺服器上查看

### 2. WiFi 穩定性
- WiFi 連接可能不如有線穩定
- 重要服務建議使用有線（身份 1）

### 3. 網路隔離
- 確保兩個網卡連接的網路可以互相訪問（如需要）
- 或實現完全隔離（安全考量）

### 4. 路由器配置
- 確保兩個網卡都獲得固定 IP
- 設定適當的端口轉發規則

---

## 🚀 下一步行動

1. **確認身份 2 的 IPv4 地址**
   - 在路由器查看或使用查詢腳本

2. **選擇運用場景**
   - 根據需求選擇合適的場景
   - 建議使用場景 1（服務分層架構）

3. **更新 Cloudflare Tunnel 配置**
   - 根據選擇的場景更新 config.yml

4. **在 Odoo 中記錄**
   - 建立伺服器身份記錄
   - 記錄服務分配策略

---

**建立時間**：2026-01-22
