# 用戶操作指南 - Google Tasks API 安裝

## 自動執行的部分（無需操作）

以下步驟會自動執行，您**不需要**做任何操作：

1. ✅ **建立系統快照** - 自動備份重要檔案
2. ✅ **建立回滾腳本** - 自動生成回滾工具
3. ✅ **檢查依賴套件** - 自動檢查已安裝的套件
4. ✅ **自動安裝套件** - 自動安裝缺失的 Python 套件
5. ✅ **開啟瀏覽器** - 自動開啟相關網頁
6. ✅ **檢測憑證檔案** - 自動檢測您下載的憑證檔案

## 需要您手動操作的部分

### 步驟 1: 在 Google Cloud Console 建立專案（約 2 分鐘）

**腳本會自動開啟瀏覽器，如果沒有，請手動訪問：**
https://console.cloud.google.com/

**操作：**
1. 登入您的 Google 帳號
2. 點擊頂部的專案選擇器
3. 點擊「新增專案」
4. 輸入專案名稱（例如：「五常系統 Google Tasks」）
5. 點擊「建立」

**完成後：** 腳本會自動進入下一步，或等待您按 Enter

---

### 步驟 2: 啟用 Google Tasks API（約 1 分鐘）

**腳本會自動開啟瀏覽器，如果沒有，請手動訪問：**
https://console.cloud.google.com/apis/library/tasks.googleapis.com

**操作：**
1. 確認已選擇正確的專案
2. 點擊「啟用」按鈕
3. 等待啟用完成

**完成後：** 腳本會自動進入下一步，或等待您按 Enter

---

### 步驟 3: 建立 OAuth 2.0 憑證（約 5 分鐘）

**腳本會自動開啟瀏覽器，如果沒有，請手動訪問：**
https://console.cloud.google.com/apis/credentials

**操作：**

#### 3.1 如果是首次使用，需要先設定 OAuth 同意畫面：

**✅ 您有 Google Workspace 非營利版，請選擇「內部」：**

1. 點擊「OAuth 同意畫面」標籤
2. **選擇「內部」**（因為您有 Google Workspace 非營利版）
3. 點擊「建立」
4. 填寫資訊：
   - **應用程式名稱**：五常系統
   - **使用者支援電子郵件**：選擇您的 Google Workspace 電子郵件
   - **應用程式標誌**：可選（可跳過）
   - **應用程式首頁連結**：可選（可跳過）
   - **應用程式隱私權政策連結**：可選（可跳過）
   - **應用程式服務條款連結**：可選（可跳過）
   - **授權網域**：自動填入您的 Google Workspace 網域
   - **開發人員聯絡資訊**：輸入您的 Google Workspace 電子郵件
5. 點擊「儲存並繼續」
6. 在「範圍」頁面，直接點擊「儲存並繼續」（使用預設）
7. 在「摘要」頁面，點擊「返回資訊主頁」

**注意：** 選擇「內部」的好處：
- ✅ 不需要 Google 驗證（更快速）
- ✅ 僅限您的 Google Workspace 組織內使用（更安全）
- ✅ 不需要公開應用程式資訊

#### 3.2 建立 OAuth 用戶端 ID：
1. 回到「憑證」頁面
2. 點擊「建立憑證」→「OAuth 用戶端 ID」
3. 如果提示需要先設定 OAuth 同意畫面，請先完成步驟 3.1
4. 選擇應用程式類型：**「桌面應用程式」**
5. 輸入名稱：**「五常系統 Google Tasks 整合」**
6. 點擊「建立」

#### 3.3 下載憑證檔案：
1. 在憑證列表中，找到剛建立的 OAuth 用戶端 ID
2. 點擊下載圖示（⬇️）或點擊憑證名稱
3. 下載 JSON 檔案到您的電腦

#### 3.4 放置憑證檔案：
1. 將下載的 JSON 檔案重新命名為：**`google_credentials.json`**
2. 將檔案移動或複製到專案目錄：
   ```
   C:\wuchang V5.1.0\wuchang-V5.1.0\google_credentials.json
   ```

**完成後：** 腳本會自動檢測憑證檔案（每 3 秒檢查一次，最多等待 5 分鐘）

---

### 步驟 4: 授權應用程式（首次使用時）

**腳本會自動處理，但可能需要您：**
1. 在自動開啟的瀏覽器中登入 Google 帳號
2. 點擊「允許」授權應用程式存取 Google Tasks
3. 授權完成後，腳本會自動繼續

---

## 快速檢查清單

在執行安裝前，請確認：

- [ ] 已登入 Google 帳號
- [ ] 可以訪問 Google Cloud Console
- [ ] 了解如何下載檔案
- [ ] 知道專案目錄位置：`C:\wuchang V5.1.0\wuchang-V5.1.0`

## 執行安裝

```powershell
python create_snapshot_before_install.py
```

## 如果遇到問題

### 問題 1: 瀏覽器沒有自動開啟
**解決方案：** 手動訪問腳本提示的網址

### 問題 2: 找不到憑證下載按鈕
**解決方案：** 
- 確認已建立 OAuth 用戶端 ID
- 在憑證列表中點擊憑證名稱進入詳情頁面
- 在詳情頁面可以下載 JSON 檔案

### 問題 3: 憑證檔案檢測不到
**解決方案：**
- 確認檔案名稱是 `google_credentials.json`（不是 `google_credentials (1).json`）
- 確認檔案在正確的目錄：`C:\wuchang V5.1.0\wuchang-V5.1.0\`
- 如果檔案在其他位置，可以手動複製到正確目錄

### 問題 4: 需要回滾
**解決方案：**
```powershell
python rollback_snapshot_YYYYMMDD_HHMMSS.py
```

## 預估時間

- **自動部分**：約 2-3 分鐘
- **手動操作**：約 8-10 分鐘
- **總計**：約 10-13 分鐘

## 完成後的驗證

安裝完成後，可以測試：

```powershell
# 測試獲取任務
python get_jules_task_direct.py "https://jules.google.com/task/18167513009276525148"
```

如果成功，表示安裝完成！
